% !TEX program = xelatex

\documentclass[crop,tikz]{standalone}

\usepackage{amsmath}
\usepackage{fontspec}
\setmainfont{CMU Serif}

\usepackage{pgfplots}
\usepgfplotslibrary{fillbetween}

\usetikzlibrary{arrows.meta}
\usetikzlibrary{calc,patterns,angles,quotes}

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,foreground}

\input{../common/boat}
\input{../common/crosshatch-pattern}
\input{../common/receiver}

\tikzset{
  satellite/.pic={
    code={
      \coordinate (center) at (0,0);
      
      % Right wing
      \coordinate (rw_top_right) at ($ (center) + (2,2.4) $);
      \coordinate (rw_bottom_right) at ($ (center) + (1.6,-2) $);
      \coordinate (rw_top_left) at ($ (center) + (0.45,2.3) $);
      \coordinate (rw_bottom_left) at ($ (center) + (0.15,-2.1) $);
      
      \draw[fill=white]
        (rw_top_right)
        --
        (rw_bottom_right)
        --
        (rw_bottom_left)
        --
        (rw_top_left)
        --
        (rw_top_right);
        
      \foreach \x in {0.2,0.4,0.6,0.8}{
        \draw[dashed]
        ($ (rw_top_left)!\x!(rw_bottom_left) $)
        --
        ($ (rw_top_right)!\x!(rw_bottom_right) $);
      }
    
      \foreach \x in {0.33,0.66}{
        \draw[dashed]
        ($ (rw_top_left)!\x!(rw_top_right) $)
        --
        ($ (rw_bottom_left)!\x!(rw_bottom_right) $);
      }
      
      % Body
      \coordinate (face_top_right) at ($ (center) + (0.75,0.75) $);
      \coordinate (face_bottom_right) at ($ (center) + (0.65,-0.75) $);
      \coordinate (face_top_left) at ($ (center) + (-0.75,0.65) $);
      \coordinate (face_bottom_left) at ($ (center) + (-0.85,-0.85) $);
      
      \draw[fill=white]
        (face_top_right)
        --
        (face_bottom_right)
        --
        (face_bottom_left)
        --
        (face_top_left)
        --
        (face_top_right);
        
      \coordinate (back_top_right) at ($ (face_top_right) + (-0.8,0.5) $);
      \coordinate (back_top_left) at ($ (face_top_left) + (-0.8,0.5) $);
      \coordinate (back_bottom_left) at ($ (face_bottom_left) + (-0.8,0.5) $);
      
      \draw[fill=white]
        (face_top_right)
        --
        (back_top_right)
        --
        (back_top_left)
        --
        (face_top_left)
        --
        (face_top_right);
        
      \draw[fill=white]
        (face_top_left)
        --
        (back_top_left)
        --
        (back_bottom_left)
        --
        (face_bottom_left)
        --
        (face_top_left);
        
      \draw[fill=white,rotate=-8] ($ (center) + (0,-0.03) $) ellipse (0.55cm and 0.65cm);
      \fill[black,rotate=-8] ($ (center) + (0,-0.03) $) ellipse (0.08cm and 0.1cm);
      
      % Left wing
      \coordinate (lw_top_right) at ($ (center) + (-0.95,2.1) $);
      \coordinate (lw_bottom_right) at ($ (center) + (-1.25,-2.2) $);
      \coordinate (lw_top_left) at ($ (center) + (-2.45,2) $);
      \coordinate (lw_bottom_left) at ($ (center) + (-2.8,-2.3) $);
      
      \draw[fill=white]
        (lw_top_right)
        --
        (lw_bottom_right)
        --
        (lw_bottom_left)
        --
        (lw_top_left)
        --
        (lw_top_right);
        
      \foreach \x in {0.2,0.4,0.6,0.8}{
        \draw[dashed]
          ($ (lw_top_left)!\x!(lw_bottom_left) $)
          --
          ($ (lw_top_right)!\x!(lw_bottom_right) $);
      }
    
      \foreach \x in {0.33,0.66}{
        \draw[dashed]
        ($ (lw_top_left)!\x!(lw_top_right) $)
        --
        ($ (lw_bottom_left)!\x!(lw_bottom_right) $);
      }
    }
  }
}

\begin{document}
\begin{tikzpicture}[domain=0:20,samples=300]
  \begin{pgfonlayer}{foreground}
    % Mountains
    \coordinate (rm_left) at (16,4);
    \coordinate (rm_top) at (17.2,5.5);
    \coordinate (rm_right) at (18.4,4);
    
    \draw[fill=white,draw opacity=0] (rm_left) -- (rm_top) -- (rm_right);
    \draw[pattern=north west lines] (rm_left) -- (rm_top) -- (rm_right);
    
    \draw[fill=white,draw opacity=0] (15,3.5) -- (16,6) -- (17,3.5);
    \draw[pattern=north east lines] (15,3.5) -- (16,6) -- (17,3.5);
    
    \path (5,11) pic[scale=0.75] {satellite};
  \end{pgfonlayer}
  
  \begin{pgfonlayer}{background}
    \draw[step=1cm,black,thin,opacity=0.2,dashed] (20.9,-0.9) grid (-0.9,15.9);
    % \draw[opacity=0] (20.9,-0.9) grid (-0.9,15.9);
    
    \draw (9,0) -- (0,0) -- (0,15) -- (20,15) -- (20,5.5);
    
    \draw (20,8) arc (90:140.5:22cm);
    \draw[dashed] (20,8.75) arc (90:142:22.75cm);
    \draw[dashed] (20,10) arc (90:144.2:24cm);
    
    \coordinate (earth_center) at (20,-14);
    
    \draw[pattern=my crosshatch dots] 
      (9,0) -- (20,0) -- (20,5.5) .. controls (18,5.5) and (16,5) .. (14,3.75) .. controls (12,1.5) and (10,1.5) .. (9,0);
  \end{pgfonlayer}
\end{tikzpicture}
\end{document}