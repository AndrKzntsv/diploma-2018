% !TEX program = xelatex
% !TeX spellcheck = ru_RU_yo

\documentclass[crop,tikz]{standalone}

\usepackage{amsmath}
\usepackage{fontspec}
\setmainfont{CMU Serif}

\usepackage{pgfplots}

\usepackage{polyglossia}
\setdefaultlanguage[spelling=modern]{russian}
\newfontfamily{\cyrillicfont}{PT Astra Sans}
\newfontfamily{\cyrillicfontsf}{PT Astra Sans}
\newfontfamily{\cyrillicfonttt}{PT Mono}

\usetikzlibrary{arrows.meta,fit,calc}

\tikzset{scheme part/.style={
  black,
  very thick,
  inner sep=0pt,
  draw=black,
  font=\huge,
  rounded corners=2mm
}}

\begin{document}
% TODO Use 'positioning' library
\begin{tikzpicture}[domain=0:20,samples=300]
  \def\modulewidth{4.5}
  \def\moduleheight{2}
  \def\moduleskip{1}

  \coordinate (start) at (0,0);


  % \draw[step=1cm,black,thin,opacity=0.2,dashed]
  \draw[opacity=0]
    ($ (start) + (-\modulewidth - \moduleskip * 2 - 0.1, -\moduleheight * 2 - \moduleskip * 3 - 0.1) $)
    grid
    ($ (start) + (\modulewidth * 4 + \moduleskip * 5 + 0.1, \moduleheight + \moduleskip * 5 + 0.1) $);


  \node[
    scheme part,
    fit={($ (start) + (-\modulewidth - \moduleskip * 2, -\moduleheight - \moduleskip * 2) $) ($ (start) + (\modulewidth * 4 + \moduleskip * 5, \moduleheight + \moduleskip * 5) $)},
    dashed
  ] (rect) {};

  \node[
    xshift=-6pt,
    yshift=4pt,
    label={right:{\LARGE Vue.js-приложение}}
  ] at ($ (start) + (-\modulewidth - \moduleskip, \moduleheight * 2 + \moduleskip * 2) $)  {};


  % Vuex
  \draw[scheme part]
    (start) rectangle (\modulewidth * 3 + \moduleskip * 2, \moduleheight)
    node[align=center, pos=.5] {Глобальное хранилище данных};


  % Settings
  \draw[scheme part]
    ($ (start) + (-\modulewidth - \moduleskip, 0) $) rectangle ($ (start) + (-\moduleskip, \moduleheight) $)
    node[align=center, pos=.5] {Настройки};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (-\moduleskip, \moduleheight * 0.5) $)
    --
    ($ (start) + (0, \moduleheight * 0.5) $);


  % Camera control
  \draw[scheme part]
    ($ (start) + (-\modulewidth - \moduleskip, \moduleheight + \moduleskip) $) rectangle ($ (start) + (-\moduleskip, \moduleheight * 2 + \moduleskip) $)
    node[align=center, pos=.5, yshift=-1.5pt] {Управление \\ камерой};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (-\moduleskip, \moduleheight + \moduleskip) $)
    --
    ($ (start) + (0, \moduleheight) $);


  % Wi-Fi
  \draw[scheme part]
    ($ (start) + (0, \moduleheight + \moduleskip) $) rectangle ($ (start) + (\modulewidth, \moduleheight * 2 + \moduleskip) $)
    node[align=center, pos=.5] {Wi-Fi};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 0.5, \moduleheight + \moduleskip) $)
    --
    ($ (start) + (\modulewidth * 0.5, \moduleheight) $);


  % Bluetooth
  \draw[scheme part]
    ($ (start) + (\modulewidth + \moduleskip, \moduleheight + \moduleskip) $) rectangle ($ (start) + (\modulewidth * 2 + \moduleskip, \moduleheight * 2 + \moduleskip) $)
    node[align=center, pos=.5] {Bluetooth};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 1.5 + \moduleskip, \moduleheight + \moduleskip) $)
    --
    ($ (start) + (\modulewidth * 1.5 + \moduleskip, \moduleheight) $);


  % RTK settings
  \draw[scheme part]
    ($ (start) + (\modulewidth * 2 + \moduleskip * 2, \moduleheight + \moduleskip) $) rectangle ($ (start) + (\modulewidth * 3 + \moduleskip * 2, \moduleheight * 2 + \moduleskip) $)
    node[align=center, pos=.5] {Настройки \\ RTK};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 2.5 + \moduleskip * 2, \moduleheight + \moduleskip) $)
    --
    ($ (start) + (\modulewidth * 2.5 + \moduleskip * 2, \moduleheight) $);


  % Correction input
  \draw[scheme part]
    ($ (start) + (\modulewidth * 3 + \moduleskip * 3, \moduleheight + \moduleskip) $) rectangle ($ (start) + (\modulewidth * 4 + \moduleskip * 4, \moduleheight * 2 + \moduleskip) $)
    node[align=center, pos=.5, yshift=-1.5pt] {Входящие \\ поправки};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 3 + \moduleskip * 3, \moduleheight + \moduleskip) $)
    --
    ($ (start) + (\modulewidth * 3 + \moduleskip * 2, \moduleheight) $);


  % Position output
  \draw[scheme part]
    ($ (start) + (\modulewidth * 3 + \moduleskip * 3, 0) $) rectangle ($ (start) + (\modulewidth * 4 + \moduleskip * 4, \moduleheight) $)
    node[align=center, pos=.5, yshift=-1.5pt] {Выдача \\ позиции};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 3 + \moduleskip * 3, \moduleheight * 0.5) $)
    --
    ($ (start) + (\modulewidth * 3 + \moduleskip * 2, \moduleheight * 0.5) $);


  % Status
  \draw[scheme part]
    ($ (start) + (\modulewidth * 3 + \moduleskip * 3, -\moduleheight - \moduleskip) $) rectangle ($ (start) + (\modulewidth * 4 + \moduleskip * 4, -\moduleskip) $)
    node[align=center, pos=.5] {Статус};

  \draw[{Latex[length=3.5mm]}-, ultra thick]
    ($ (start) + (\modulewidth * 3 + \moduleskip * 3, -\moduleskip) $)
    --
    ($ (start) + (\modulewidth * 3 + \moduleskip * 2, 0) $);


  % Survey
  \draw[scheme part]
    ($ (start) + (\modulewidth * 2 + \moduleskip * 2, -\moduleheight - \moduleskip) $) rectangle ($ (start) + (\modulewidth * 3 + \moduleskip * 2, -\moduleskip) $)
    node[align=center, pos=.5] {Изыскания};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 2.5 + \moduleskip * 2, -\moduleskip) $)
    --
    ($ (start) + (\modulewidth * 2.5 + \moduleskip * 2, 0) $);


  % Battery
  \draw[scheme part]
    ($ (start) + (\modulewidth + \moduleskip, -\moduleheight - \moduleskip) $) rectangle ($ (start) + (\modulewidth * 2 + \moduleskip, -\moduleskip) $)
    node[align=center, pos=.5] {Батарея};

  \draw[{Latex[length=3.5mm]}-, ultra thick]
    ($ (start) + (\modulewidth * 1.5 + \moduleskip, -\moduleskip) $)
    --
    ($ (start) + (\modulewidth * 1.5 + \moduleskip, 0) $);


  % Logging
  \draw[scheme part]
    ($ (start) + (0, -\moduleheight - \moduleskip) $) rectangle ($ (start) + (\modulewidth, -\moduleskip) $)
    node[align=center, pos=.5] {Логирование};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 0.5, -\moduleskip) $)
    --
    ($ (start) + (\modulewidth * 0.5, 0) $);


  % Base mode
  \draw[scheme part]
    ($ (start) + (-\modulewidth - \moduleskip, -\moduleheight - \moduleskip) $) rectangle ($ (start) + (-\moduleskip, -\moduleskip) $)
    node[align=center, pos=.5] {Режим \\ базы};

  \draw[{Latex[length=3.5mm]}-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (-\moduleskip, -\moduleskip) $)
    --
    ($ (start) + (0, 0) $);


  % Events module
  \draw[scheme part]
    ($ (start) + (-\modulewidth - \moduleskip, -\moduleheight * 2 - \moduleskip * 3) $) rectangle ($ (start) + (\modulewidth * 1.5 + \moduleskip * 0.5, -\moduleheight - \moduleskip * 3) $)
    node[align=center, pos=.5] {Модуль обработки событий};

  \draw[-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth + \moduleskip * 0.5, -\moduleheight - \moduleskip * 3) $)
    --
    ($ (start) + (\modulewidth + \moduleskip * 0.5, 0) $);


  % OL wrapper
  \draw[scheme part]
    ($ (start) + (\modulewidth * 1.5 + \moduleskip * 1.5, -\moduleheight * 2 - \moduleskip * 3) $) rectangle ($ (start) + (\modulewidth * 4 + \moduleskip * 4, -\moduleheight - \moduleskip * 3) $)
    node[align=center, pos=.5] {Модуль работы с картами};

  \draw[-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 2.5 + \moduleskip * 2, -\moduleheight - \moduleskip * 3) $)
    --
    ($ (start) + (\modulewidth * 2.5 + \moduleskip * 2, -\moduleheight - \moduleskip) $);

  \draw[-{Latex[length=3.5mm]}, ultra thick]
    ($ (start) + (\modulewidth * 3.5 + \moduleskip * 3, -\moduleheight - \moduleskip * 3) $)
    --
    ($ (start) + (\modulewidth * 3.5 + \moduleskip * 3, -\moduleheight - \moduleskip) $);
\end{tikzpicture}
\end{document}